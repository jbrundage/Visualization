let test_seri = `{ "__class": "marshaller_HTML", "__version": "1.14.8-rc3", "__properties": { "designMode": false, "surfacePadding": "0", "content": [{ "__class": "layout_Cell", "__version": "1.14.6-rc1", "__properties": { "gridRow": 0, "gridCol": 0, "gridRowSpan": 6, "gridColSpan": 6, "title": "", "widget": { "__class": "composite_MegaChart", "__id": "Map", "__version": "1.14.6-rc1", "__properties": { "title": "Business Map", "chartType": "TABLE_GMAP_PIN", "chart": { "__class": "map_GMapPin", "__version": "1.14.6-rc1", "__properties": { "pinColor": "#ff4f4f", "latitudeColumn": "addresslatitude", "longtitudeColumn": "addresslongitude", "fields": [{ "__class": "common_Database.Field", "__id": "_pe271", "__properties": { "label": "ultid", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe272", "__properties": { "label": "addresslatitude", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe273", "__properties": { "label": "addresslongitude", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe274", "__properties": { "label": "customer_account", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe275", "__properties": { "label": "pininfo", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe276", "__properties": { "label": "legal_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe277", "__properties": { "label": "dba_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe278", "__properties": { "label": "bus_contact_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe279", "__properties": { "label": "bus_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe280", "__properties": { "label": "bus_secondary_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe281", "__properties": { "label": "bus_city", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe282", "__properties": { "label": "bus_state", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe283", "__properties": { "label": "bus_zip", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe284", "__properties": { "label": "busi_mailing_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe285", "__properties": { "label": "bus_secondary_mailing_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe286", "__properties": { "label": "bus_mailing_city", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe287", "__properties": { "label": "bus_mailing_state", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe288", "__properties": { "label": "bus_mailing_zip", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe289", "__properties": { "label": "ro_name_1", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe290", "__properties": { "label": "ro_name_2", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe291", "__properties": { "label": "ro_name_3", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe292", "__properties": { "label": "bus_ph_nbr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe293", "__properties": { "label": "contact_ph_nbr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe294", "__properties": { "label": "regd_agent_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe295", "__properties": { "label": "seleid", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe296", "__properties": { "label": "proxid", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe297", "__properties": { "label": "customeraccount", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe298", "__properties": { "label": "businessname", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe299", "__properties": { "label": "businessaddress", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe300", "__properties": { "label": "businesscity", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe301", "__properties": { "label": "businessstate", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe302", "__properties": { "label": "businesszip", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe303", "__properties": { "label": "fein", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe304", "__properties": { "label": "reportedofficername", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe305", "__properties": { "label": "reportedofficeraddress", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe306", "__properties": { "label": "reportedofficercity", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe307", "__properties": { "label": "reportedofficerstate", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe308", "__properties": { "label": "reportedofficerzip", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe309", "__properties": { "label": "ssn", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe310", "__properties": { "label": "shownewbusinesses", "type": "" } }] } } } }, "surfacePadding": "0", "surfaceBorderWidth": 1, "fields": [] } }, { "__class": "layout_Cell", "__version": "1.14.6-rc1", "__properties": { "gridRow": 0, "gridCol": 6, "gridRowSpan": 6, "gridColSpan": 2, "title": "", "widget": { "__class": "layout_Surface", "__version": "1.14.6-rc1", "__properties": { "title": "BusinessHierarchy", "widget": { "__class": "graph_Graph", "__id": "BusinessHierarchy", "__version": "1.14.6-rc1", "__properties": { "layout": "Hierarchy", "fields": [{ "__class": "common_Database.Field", "__id": "_pe226", "__properties": { "label": "uid", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe227", "__properties": { "label": "label", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe228", "__properties": { "label": "weight", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe229", "__properties": { "label": "flags", "type": "" } }] } }, "surfaceBackgroundColor": "#08304b", "fields": [] } }, "surfacePadding": "0", "surfaceBorderWidth": 1, "fields": [] } }, { "__class": "layout_Cell", "__version": "1.14.6-rc1", "__properties": { "gridRow": 6, "gridCol": 0, "gridRowSpan": 3, "gridColSpan": 8, "title": "", "widget": { "__class": "composite_MegaChart", "__id": "Search", "__version": "1.14.6-rc1", "__properties": { "title": "Search", "chart": { "__class": "other_Table", "__version": "1.14.6-rc1", "__properties": { "pagination": false, "itemsPerPage": 6, "showHeader": true, "fixedHeader": false, "tableZebraColor": "08304b", "fields": [ { "__class": "common_Database.Field", "__id": "_pe335", "__properties": { "label": "ultid", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe336", "__properties": { "label": "customer_account", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe337", "__properties": { "label": "legal_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe338", "__properties": { "label": "dba_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe339", "__properties": { "label": "bus_contact_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe340", "__properties": { "label": "bus_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe341", "__properties": { "label": "bus_secondary_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe342", "__properties": { "label": "bus_city", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe343", "__properties": { "label": "bus_state", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe344", "__properties": { "label": "bus_zip", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe345", "__properties": { "label": "busi_mailing_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe346", "__properties": { "label": "bus_secondary_mailing_addr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe347", "__properties": { "label": "bus_mailing_city", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe348", "__properties": { "label": "bus_mailing_state", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe349", "__properties": { "label": "bus_mailing_zip", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe350", "__properties": { "label": "ro_name_1", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe351", "__properties": { "label": "ro_name_2", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe352", "__properties": { "label": "ro_name_3", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe353", "__properties": { "label": "bus_ph_nbr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe354", "__properties": { "label": "contact_ph_nbr", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe355", "__properties": { "label": "regd_agent_name", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe356", "__properties": { "label": "seleid", "type": "" } }, { "__class": "common_Database.Field", "__id": "_pe357", "__properties": { "label": "proxid", "type": "" } } ] } } } }, "surfacePadding": "0", "surfaceBackgroundColor": "", "surfaceBorderWidth": 1, "fields": [] } }], "fields": [] } }`;
v1_to_v2_layout(test_seri);
function v1_to_v2_layout(json_str){
    let _rects = parse_rects(json_str,",");
    console.info(`_rects`,_rects);
    let score_arr = [];
    _rects.forEach(rect=>{
        score_arr.push(get_score_arr(rect,_rects));
    });
    let pair_arr = [];
    let rect_copy = JSON.parse(JSON.stringify(_rects));
    
    return pair_arr;
}
function get_score_arr(rect,_rects){
    let arr = [];
    _rects.forEach(r=>{
        if(r === rect){
            arr.push(0);
        } else {
            arr.push(compat_score(rect,r));
        }
    });
    return arr;
}
function parse_rects(str,splitter2){
    let parse1 = [
        `"gridRow":`,
        `"gridCol":`,
        `"gridRowSpan":`,
        `"gridColSpan":`
    ].map((pat,i)=>{
        let _pat_split = str.split(pat);
        return _pat_split.slice(1).map(n=>{
            return $.trim(n.split(splitter2)[0])
        });
    });
    return parse1[0].map((n,i)=>{
        return parse1.map(n2=>parseInt(n2[i]));
    });
}
function compat_score(_a,_b){
    let patterns = {
        "L_W":{points: 2, callback: function(a,b){return a[0] === b[0] && a[2] === b[2]}},
        "T_H":{points: 1, callback: function(a,b){return a[1] === b[1] && a[3] === b[3]}},
        "L_R":{points: 100, callback: function(a,b){
            return (a[0] === b[0] + b[2]) || (b[0] === a[0] + a[2])
        }},
        "T_B":{points: 100, callback: function(a,b){
            return (a[1] === b[1] + b[3]) || (b[1] === a[1] + a[3])
        }},
    };
    let score_arr = Object.keys(patterns)
        .filter(pattern=>{
            return patterns[pattern].callback(_a,_b);
        })
        .map(n=>patterns[n].points);
    if(score_arr.length === 0){
        return 0;
    } else {
        return score_arr.reduce((sum,n)=>sum + n);
    }
}